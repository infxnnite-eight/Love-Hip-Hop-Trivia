var newTabExt=function(){this.initAutocomplete();this.changeBg();this.setBgLikes();if(typeof(localStorage['photos_list_timestamp'])=='undefined'||(Date.now()-parseInt(localStorage['photos_list_timestamp']))>84400000){this.isUpdatedPhotosList();}
if(ex_installed){if($('.twitch-menu').length>0)this.twtichStreaming(60000);if($('#twitter_draggable').length>0)this.showTwitterFeed();if($('#youtube_draggable').length>0)this.showYouTubeFeed(1800000);if($('#tdl-holder').length>0)this.initToDoList();if($('.weather-body').length>0)this.initWeatherWidget(3600000);if($('.clock-container').length>0)this.initClock();if(has_screensaver)this.screenSaver(10000);this.initDragableContainers();}}
newTabExt.prototype={initWeatherWidget:function(check_interval){var unit=this.getWeatherUnit();$('.choice[data-value="'+unit+'"]').addClass('on');setInterval(this._getAndSetWeather.bind(this),check_interval);},getWeatherUnit:function(){return(typeof localStorage['weather_units']!='undefined')?localStorage['weather_units']:'c';},_getAndSetWeather:function(){if(typeof this._getHiddenWidgets()['.weather-body']!='undefined')return false;var timestamp=localStorage.getItem("weatherTimestamp");if(timestamp&&Date.now()-timestamp<(6*60*60*1000)&&localStorage.getItem("weather")){this._setWeather();}else{this._getWeather();}},_getWeather:function(){var self=this;if(typeof(localStorage['selected_location'])!='undefined'){var location=JSON.parse(localStorage['selected_location']);location['unit']=self.getWeatherUnit();self.apiWeatherRequest(location);}else{$.ajax({url:SITE_URL+'?action=getLocationByIpAdress',type:'GET',dataType:'json',success:function(location){localStorage['cityname']=(location.city.length>0)?location.city:((location.region_name.length>0)?location.region_name:location.country_name);var location={'country_code':location.country_code,'region_code':(location.region_code.length>0)?location.region_code:localStorage['cityname'],'lat':location.latitude,'lng':location.longitude,'unit':(typeof localStorage['weather_units']!='undefined')?localStorage['weather_units']:null};self.apiWeatherRequest(location);}});}},toggleWeatherUnits:function(){var unit=(typeof localStorage['weather_units']!='undefined')?localStorage['weather_units']:'c';localStorage['weather_units']=(unit=='c')?'f':'c';this._getWeather();},apiWeatherRequest:function(location){var self=this;$.ajax({dataType:"json",url:SITE_URL+'?action=ajaxGetWeather&lang='+LANG,type:'POST',data:location,success:function(data){if(data.status){localStorage['weatherTimestamp']=Date.now();localStorage['weather']=JSON.stringify(data.weather);self._setWeather();}else{$('.weather-body').addClass('d-none');}}});},getTimestamp:function(){const date=new Date();const day=date.getDate();const month=date.getMonth()+1;const year=date.getFullYear();const hours=date.getHours();return Date.parse(`${year}-${month}-${day} ${hours}:00`)/1000;},getIcon:function(code,is_day){const icon_map={1000:is_day?'wi-day-sunny':'wi-night-clear',1003:is_day?'wi-day-cloudy':'wi-night-alt-cloudy',1006:'wi-cloud',1009:'wi-cloud',1030:'wi-fog',1063:is_day?'wi-day-showers':'wi-night-alt-showers',1066:is_day?'wi-day-snow':'wi-night-alt-snow',1069:is_day?'wi-day-sleet':'wi-night-alt-sleet',1072:'wi-showers',1087:is_day?'wi-day-thunderstorm':'wi-night-alt-thunderstorm',1114:'wi-snow-wind',1117:'wi-snow-wind',1135:'wi-fog',1147:'wi-fog',1150:'wi-showers',1153:'wi-showers',1168:'wi-showers',1171:'wi-showers',1180:is_day?'wi-day-rain':'wi-night-alt-rain',1183:'wi-rain',1186:is_day?'wi-day-rain':'wi-night-alt-rain',1189:'wi-rain',1192:is_day?'wi-day-rain':'wi-night-alt-rain',1195:'wi-rain',1198:'wi-rain',1201:'wi-rain',1204:'wi-sleet',1207:'wi-sleet',1210:is_day?'wi-day-snow':'wi-night-alt-snow',1213:'wi-snow',1216:is_day?'wi-day-snow':'wi-night-alt-snow',1219:'wi-snow',1222:is_day?'wi-day-snow':'wi-night-alt-snow',1225:'wi-snow',1237:'wi-snow',1240:is_day?'wi-day-showers':'wi-night-alt-showers',1243:is_day?'wi-day-showers':'wi-night-alt-showers',1246:is_day?'wi-day-showers':'wi-night-alt-showers',1249:is_day?'wi-day-sleet':'wi-night-alt-sleet',1252:is_day?'wi-day-sleet':'wi-night-alt-sleet',1255:is_day?'wi-day-snow':'wi-night-alt-snow',1258:is_day?'wi-day-snow':'wi-night-alt-snow',1261:is_day?'wi-day-hail':'wi-night-alt-hail',1264:is_day?'wi-day-hail':'wi-night-alt-hail',1273:is_day?'wi-day-thunderstorm':'wi-night-alt-thunderstorm',1276:is_day?'wi-day-thunderstorm':'wi-night-alt-thunderstorm',1279:is_day?'wi-day-snow-thunderstorm':'wi-night-alt-snow-thunderstorm',1282:is_day?'wi-day-snow-thunderstorm':'wi-night-alt-snow-thunderstorm',};return icon_map[code];},_setWeather:function(){let weather=localStorage['weather'];if(!weather){this._getWeather();return;}
const timestamp=this.getTimestamp();weather=JSON.parse(weather);weather=weather[timestamp];if(!weather){this._getWeather();return;}
weather.wind_mps=weather.wind_kph*1000/60/60;const temp_unit=this.getWeatherUnit();$("#icon").html(`<i class="wi ${this.getIcon(weather.condition_code,weather.is_day)}"></i>`);let temp_char;let windspeed_char;let speed_unit;if(temp_unit==='c'){temp_char='C';windspeed_char='m/s';speed_unit='mps';}else{temp_char='F';windspeed_char='m/h';speed_unit='mph';}
$(".temp0").html(weather['temp_'+temp_unit]+`<sup><small>°${temp_char}</small> </sup>`);$(".info").html(weather.info);$(".iconInfo").html(`<i class='wi wi-cloud'></i> ${weather.cloud}%  
             <i class='wi wi-humidity'></i> ${weather.humidity}%  
             <i class='wi wi-strong-wind'></i> ${Math.round(weather['wind_'+speed_unit]*10)/10} ${windspeed_char}`);$(".feelslike").html(Math.round(weather['feelslike_'+temp_unit])+"°"+temp_char);if(localStorage['cityname']){$(".city").html(localStorage['cityname']);}
$('.weather_container').removeClass('d-none');},resetSettings:function(){var dragged_containers=this._getDraggedContajners();if(Object.keys(dragged_containers).length>0){$.each(dragged_containers,function(key,data){$('#'+key).removeAttr('style');});localStorage.removeItem('dragged_containers');}
$('.toggle_widget').prop('checked',false).change();this.enableDefaultWidgets();},enableDefaultWidgets:function(){if(typeof(default_widgets)=='undefined'||default_widgets.length==0)return;$.each(default_widgets,function(){$('.toggle_widget[data-generator_id="'+this+'"]').prop('checked',true).change();});},initDragableContainers:function(){var dragged_containers=this._getDraggedContajners();if(Object.keys(dragged_containers).length>0){$.each(dragged_containers,function(key,data){$('#'+key).css(data);});}
$(".draggable").draggable({handle:'.handler',stop:function(event,ui){dragged_containers[$(ui.helper[0]).attr('id')]=ui.position;localStorage['dragged_containers']=JSON.stringify(dragged_containers);}});},_getDraggedContajners:function(){var dragged_containers=localStorage['dragged_containers'];if(typeof(dragged_containers)=='undefined'||!dragged_containers)dragged_containers={};else dragged_containers=JSON.parse(dragged_containers);return dragged_containers;},showYouTubeFeed:function(check_interval){$('.toggle_widget[data-generator_id="24"]').parent().removeClass('d-none');if(typeof(this._getVisibleWidgets()['#youtube_draggable'])!='undefined')$('.toggle_widget[data-selector="#youtube_draggable"]').prop('checked',true).change();setInterval(this._getAndSetYTFeed.bind(this),check_interval);},_getAndSetYTFeed:function(){if(typeof this._getHiddenWidgets()['#youtube_draggable']!='undefined')return false;var self=this;if(typeof(localStorage['youtube_timestamp'])!='undefined'&&Date.now()-localStorage['youtube_timestamp']<1800000){data=JSON.parse(localStorage['youtube_feed']);self._setYTFeed(data);}else{$.ajax({url:SITE_URL+'?action=ajaxGetYouTubeFeed',type:'POST',data:{'channel_id':youtube_chanel_id},dataType:'json',success:function(data){localStorage['youtube_timestamp']=Date.now();localStorage['youtube_feed']=JSON.stringify(data);self._setYTFeed(data);},});}},_setYTFeed:function(data){if(typeof data.items!='undefined'){$('.youtube-body').find('.card:not(.clone)').remove();var now=new Date();for(c=data.items.length-1,i=c;i>=0;i--){if(i==c){$('.channel-title').text(data.items[i].snippet.channelTitle);$('.channel-link').attr('title',data.items[i].snippet.channelTitle);$('.channel-link').attr('href','https://www.youtube.com/channel/'+data.items[i].snippet.channelId);}
var clone=$('.youtube-container').find('.clone').clone(true);clone.removeClass('clone').removeClass('d-none');clone.find('img').attr('src',data.items[i].snippet.thumbnails.medium.url).show();clone.find('a').attr('href','https://www.youtube.com/watch?v='+data.items[i].id.videoId).attr('title',data.items[i].snippet.title);clone.find('.card-title').find('a').text(data.items[i].snippet.title);var date=new Date(data.items[i].snippet.publishedAt);var difference=now-date;var diff=new moment.duration(difference);if(diff._data.years>0){value=diff._data.years;str='year'+((diff._data.years>1)?'s':'');}else if(diff._data.months>0){value=diff._data.months;str='month'+((diff._data.months>1)?'s':'');}else if(diff._data.days>0){if(diff._data.days>=7){value=Math.round(diff._data.days/7);str='week'+((value>1)?'s':'');}else{value=diff._data.days;str='day'+((diff._data.days>1)?'s':'');}}else if(diff._data.hours>0){value=diff._data.hours;str='hour'+((diff._data.hours>1)?'s':'');}else{value=diff._data.minutes;str='minute'+((diff._data.minutes>1)?'s':'');}
clone.find('.ago_str').text(value+' '+this.translateStr(str));$('.youtube-body').prepend(clone);}}},showTwitterFeed:function(){$('.toggle_widget[data-generator_id="17"]').parent().removeClass('d-none');var self=this;if(typeof(self._getVisibleWidgets()['#twitter_draggable'])!='undefined')$('.toggle_widget[data-selector="#twitter_draggable"]').prop('checked',true).change();var interval=setInterval(function(self){var iframe=$('.twitter-timeline-container').find('iframe');if(iframe.contents().find(".timeline-Widget").length>0){iframe.contents().find('head').append('<style>.blue-scroll::-webkit-scrollbar-track { -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3); background-color: #636c72; } .blue-scroll::-webkit-scrollbar { width: 6px; background-color: #636c72; } .blue-scroll::-webkit-scrollbar-thumb { background-color: #1da1f2; }</style>');iframe.contents().find('.timeline-Body').css('height','405').css('overflow','auto').addClass('blue-scroll');iframe.contents().find('.timeline-Widget').css('background-color','rgba(34, 39, 47, 0.6901960784313725)!important;');iframe.contents().find(".timeline-Widget").css('border-radius','0');iframe.contents().find(".timeline-InformationCircle:first").remove();clearInterval(interval);}},100);dataType:'html'},showHideWidgets:function(){visible_widgets=this._getVisibleWidgets();if(Object.keys(visible_widgets).length>0){var self=this;$.each(visible_widgets,function(key,data){$('.toggle_widget[data-selector="'+data.selector+'"]').prop('checked',true).change();$(data.selector).removeClass('d-none');});}},_getVisibleWidgets:function(){var visible_widgets=localStorage['visible_widgets'];visible_widgets=(typeof visible_widgets=='undefined')?{}:JSON.parse(visible_widgets);return visible_widgets;},_setVisibleWidgets(visible_widgets){localStorage['visible_widgets']=JSON.stringify(visible_widgets);},_getHiddenWidgets:function(){var hidden_widgets=localStorage['hidden_widgets'];hidden_widgets=(typeof hidden_widgets=='undefined')?{}:JSON.parse(hidden_widgets);return hidden_widgets;},_setHiddenWidgets:function(hidden_widgets){localStorage['hidden_widgets']=JSON.stringify(hidden_widgets);},initToDoList:function(){var todo_list=this._getToDoList();var self=this;if(Object.keys(todo_list).length>0){$.each(todo_list,function(key,data){self.addToDoListItem(key,data);});}},addToDoListItem:function(key,data){var li=$('.todo_clone').clone();li.removeClass('todo_clone').removeClass('d-none');li.attr('data-id',key);li.find('span').text(data.value);if(data.is_checked!='undefined'&&data.is_checked)li.find('input').prop('checked',true);$('.todo_list').append(li);$('.todo_list').scrollTop($('.todo_list')[0].scrollHeight);},removeToDoListItem:function(key){var _li=$('ul.todo_list').find('li[data-id="'+key+'"]');_li.addClass("remove").stop().delay(100).slideUp("fast",function(){_li.remove();});},addToDo:function(value){todo_list=this._getToDoList();var key=Date.now();todo_list[key]={'value':value};this.setToDoList(todo_list);this.addToDoListItem(key,todo_list[key]);},deleteToDo:function(key){todo_list=this._getToDoList();delete todo_list[key];this.setToDoList(todo_list);},updateToDoIsChecked:function(key,is_checked){todo_list=this._getToDoList();todo_list[key].is_checked=is_checked;this.setToDoList(todo_list);},_getToDoList:function(key){var todo_list=localStorage['todo_list'];todo_list=(typeof todo_list=='undefined')?{}:JSON.parse(todo_list);return(typeof key=='undefined')?todo_list:todo_list[key];},setToDoList:function(todo_list){var todo_list=JSON.stringify(todo_list);localStorage['todo_list']=todo_list;},twtichStreaming:function(check_interval){this._getAndSetTwitchStremBtn(check_interval);setInterval(this._getAndSetTwitchStremBtn.bind(this,check_interval),check_interval);},_getAndSetTwitchStremBtn:function(check_interval){if(typeof(localStorage['twitch_timestamp'])!='undefined'&&Date.now()-localStorage['twitch_timestamp']<check_interval){data=JSON.parse(localStorage['twitch_data']);this._setTwtichStreamBtn(data);}else{var self=this;$.ajax({url:SITE_URL+'?action=ajaxGetTwitchStreamByUserId',type:'POST',data:{'user_id':twitch_user_id},dataType:'json',success:function(data){localStorage['twitch_timestamp']=Date.now();localStorage['twitch_data']=JSON.stringify(data);self._setTwtichStreamBtn(data);},});}},_setTwtichStreamBtn:function(data){$('.twitch-logo').attr('src',data.logo);$('.twitch-menu').find('a').attr('href',data.url).attr('title',data.status);$('.player-name').text(data.display_name);if(data.is_online){$('.twitch-menu').hover(function(){$('.video-screen').fadeIn(100);},function(){$('.video-screen').fadeOut(100);});$('.game_name').text(data.game).attr('title',data.game);$('.viwers_cn').removeClass('d-none').text(data.viewers);$('.video_thumb').attr('src',data.video_thumb);$('.video-desc').text(data.status);$('.live-circle').removeClass('d-none');$('.twitch-menu').removeClass('offline');}else{$('.twitch-menu').unbind('mouseenter mouseleave');$('.game_name').text(this.translateStr('offline'));$('.live-circle').addClass('d-none');$('.viwers_cn').addClass('d-none');$('.twitch-menu').addClass('offline');}},translateStr:function(str){return(typeof translates[str]!='undefined')?translates[str]:str;},initClock:function(){var clock_format=this._getClockFormat();$('[name="clock_format"][value="'+clock_format+'"]').prop('checked',true);this._setClock();setInterval(this._setClock.bind(this),1000);},toggleClockFormat:function(){var clock_format=this._getClockFormat();clock_format=(clock_format=='12')?'24':'12';localStorage['clock_format']=clock_format;this._setClock();},_getClockFormat:function(){return(typeof localStorage['clock_format']!='undefined')?localStorage['clock_format']:'12';},_setClock:function(){var self=this;var data={getDay:function(par){return days[par];},getMonth:function(par){return months[par];}};var date=new Date();var time={hour:(function(){var format=self._getClockFormat();var pm,am;if(format=='12'){if(date.getHours()>=13&&date.getHours()<=23){return{current:date.getHours()-12,AmPm:"pm"}}
if(date.getHours()===0){return{current:date.getHours()+12,AmPm:"am"}}
if(date.getHours()===12){return{current:date.getHours(),AmPm:"pm"}}
return{current:date.getHours(),AmPm:"am"}}else{return{current:date.getHours(),AmPm:""}}}()),minute:(date.getMinutes()<10?'0':'')+date.getMinutes(),day:data.getDay(date.getDay()),date:date.getDate(),month:data.getMonth(date.getMonth()),};document.querySelector(".time").innerHTML=time.hour.current+":"+time.minute+" "+time.hour.AmPm;document.querySelector(".date").innerHTML=time.day+" "+time.date+", "+time.month;},screenSaver:function(screensaver_time){var timeout;var self=this;timeout=setTimeout(function(){self.activeScreenSaver();},screensaver_time);$(document).on('keydown click mousemove wheel contextmenu',function(){clearTimeout(timeout);self.deactiveScreenSaver();timeout=setTimeout(function(){self.activeScreenSaver();},screensaver_time);});setTimeout(function(){$.each($('iframe[id]'),function(key,iframe){$(iframe).contents().on('keydown click mousemove wheel contextmenu',function(){clearTimeout(timeout);self.deactiveScreenSaver();timeout=setTimeout(function(){self.activeScreenSaver();},screensaver_time);});});},3000);},incrementNewtabCounter:function(){var cn=localStorage['new_tabs_counter'];cn=(typeof(cn)!='undefined')?parseInt(cn):0;localStorage['new_tabs_counter']=++cn;return cn;},activeScreenSaver:function(){if($('.modal:visible').length>0||$('.cd-tour-wrapper.active').length>0)return false;$('div:not(body,.clock-container,.fluid-container,.clock-container,.clock-container *,[class^="modal-"],[class^="video-"]):visible').addClass('screensaver').fadeTo("slow",0);},deactiveScreenSaver(){$('.screensaver').removeClass('screensaver').fadeTo("slow",1);},initAutocomplete:function(){var self=this;$("#search-bar").autocomplete({appendTo:$(".search_form"),source:function(request,response){$.ajax({url:'https://suggestqueries.google.com/complete/search?client=firefox&q='+request.term,dataType:'jsonp'}).done(function(data){response(data[1].slice(0,7));});},select:function(event,ui){self.searchSubmit(ui.item.value);}});},searchSubmit:function(keyword){$('.search_form').find('[name="q"]').val(keyword);$('.search_form').submit();},clearOldData:function(){localStorage.removeItem('photos_list_timestamp');localStorage.removeItem('photos_list');localStorage.removeItem('next_photo');localStorage.removeItem('photo_key');localStorage.removeItem('all_images_downloaded');localStorage.removeItem('lock_background');localStorage.removeItem('youtube_timestamp');localStorage.removeItem('youtube_feed');localStorage.removeItem('twitch_data');localStorage.removeItem('twitch_timestamp');},changeBg:function(){if(!this.isLockedBackground())this._getNextPhoto();},_getNextPhoto:function(callback){var photo_key=parseInt(localStorage['photo_key']);if(isNaN(photo_key)){photo_key=0;}
var api_photos_list=localStorage['photos_list'];if(typeof(api_photos_list)=='undefined'||!api_photos_list){var self=this;this._getPhotosList(function(data){localStorage['photos_list']=JSON.stringify(data);self._loadNextPhoto(data,photo_key,callback);});}else{this._loadNextPhoto(JSON.parse(localStorage['photos_list']),photo_key);}},isUpdatedPhotosList:function(callback){localStorage['photos_list_timestamp']=Date.now();if(typeof(localStorage['photos_list'])=='undefined')this._getNextPhoto(callback);else{this._getPhotosList(function(data){if(localStorage['photos_list']!==JSON.stringify(data)){old_images=JSON.parse(localStorage['photos_list']);new_images=this._imagesDiff(data.images,old_images.images);if(new_images.length>0){images=old_images.images.concat(new_images);photos_list={'images':images,'total_images':images.length};localStorage['photos_list']=JSON.stringify(photos_list);delete new_images;delete photos_list;if(typeof localStorage['all_images_downloaded']!='undefined'){var photo_key=parseInt(localStorage['photo_key']);if(isNaN(photo_key)){photo_key=0;}else{photo_key=old_images.total_images;}
localStorage['photo_key']=photo_key;localStorage.removeItem('all_images_downloaded');if(typeof(localStorage['lock_background'])!='undefined')this._getNextPhoto();}}}}.bind(this));}},_imagesDiff:function(a1,a2){var a=[],diff=[];for(var i=0;i<a1.length;i++){a[a1[i].url]=true;}
for(var i=0;i<a2.length;i++){if(a[a2[i].url]){delete a[a2[i].url];}else{a[a2[i].url]=true;}}
for(var k in a)diff.push({'url':k});return diff;},_getPhotosList:function(callback){$.ajax({url:ROOT_URL,type:'GET',cache:false,dataType:'json',data:{'action':'getBackroundImages','cws_id':chrome_extension_id},success:function(data){if(data.total_images==0)return false;callback(data);},error:function(data){return false;}});},_loadNextPhoto:function(api_photos_list,photo_key,callback){if(photo_key>=api_photos_list.total_images){photo_key=localStorage['photo_key']=0;}else if(photo_key==-1)photo_key=0;var self=this;if(typeof(api_photos_list.images[photo_key])=='undefined')self._loadNextPhoto(api_photos_list,photo_key+1,callback);setTimeout(function(){var image=new Image();image.onload=function(){localStorage['next_photo']=api_photos_list.images[photo_key].url;localStorage['photo_key']=photo_key+1;if(typeof(callback)!='undefined')callback();}
image.onerror=function(){self._loadNextPhoto(api_photos_list,photo_key+1)}
image.src=api_photos_list.images[photo_key].url;},500);},lockBackground:function(){localStorage['next_photo']=$('body').css('background-image').replace('url(','').replace(')','').replace(/\"/gi,"");localStorage['photo_key']=$('body').data('photo_key');return localStorage['lock_background']=true;},unlockBackground:function(){localStorage.removeItem('lock_background');this._getNextPhoto();},isLockedBackground:function(){return(typeof(localStorage['lock_background'])!='undefined');},_getCurrentPhotoKey:function(){return($('body').data('photo_key')?$('body').data('photo_key'):-1);},likeImage:function(){var self=this;var photo_key=this._getCurrentPhotoKey();if(this.isLikedImage(photo_key))return false;if(this.isDislikedImage(photo_key)){var images=self.getDislikedImages();var index=images.indexOf(photo_key);images.splice(index,1);this.setDislikedImages(images);var remove_dislike=true}
var images=self.getLikedImages();images.push(photo_key);self.setLikedImages(images);},removeLikedImage:function(){var photo_key=this._getCurrentPhotoKey();if(!this.isLikedImage(photo_key))return false;var images=this.getLikedImages();var index=images.indexOf(photo_key);images.splice(index,1);this.setLikedImages(images);},dislikeImage:function(){var self=this;var photo_key=this._getCurrentPhotoKey();if(this.isDislikedImage(photo_key))return false;if(this.isLikedImage(photo_key)){var images=self.getLikedImages();var index=images.indexOf(photo_key);images.splice(index,1);this.setLikedImages(images);var remove_like=true}
var images=self.getDislikedImages();images.push(photo_key);self.setDislikedImages(images);},removeDisLikedImage:function(){var photo_key=this._getCurrentPhotoKey();if(!this.isDislikedImage(photo_key))return false;var images=this.getDislikedImages();var index=images.indexOf(photo_key);images.splice(index,1);this.setDislikedImages(images);},getDislikedImages:function(){var images=localStorage['disliked_images'];images=(typeof images=='undefined')?[]:JSON.parse(images);return images;},setDislikedImages:function(images){localStorage['disliked_images']=JSON.stringify(images);},getLikedImages:function(){var images=localStorage['liked_umages'];images=(typeof images=='undefined')?[]:JSON.parse(images);return images;},setLikedImages:function(liked_images){localStorage['liked_umages']=JSON.stringify(liked_images);},setBgLikes:function(){var photo_key=this._getCurrentPhotoKey();if(this.isLikedImage(photo_key))$('.like-menu').find('.menu').addClass('disabled');else if(this.isDislikedImage(photo_key))$('.dislike-menu').find('.menu').addClass('disabled');},isLikedImage:function(photo_key){var images=this.getLikedImages();return(images.indexOf(photo_key)>-1);},isDislikedImage:function(photo_key){var images=this.getDislikedImages();return(images.indexOf(photo_key)>-1);},loadThemesGallery:function(){$('#gallery-modal').fadeIn();$('.modal-overlay').fadeIn();if($('#gallery-modal').hasClass('themes_loaded'))return false;$.ajax({url:ajax_load_themes,type:'GET',dataType:'html',success:function(data){$('ul.extensions-list').replaceWith(data);$('#gallery-modal').addClass('themes_loaded');var modal_body=$('#gallery-modal').find('.modal-body');var page=1;modal_body.scroll(function(){if($(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight){$.each($('.extensions-list').find('li[data-page="'+ ++page+'"]'),function(){var img=$(this).find('[data-src]');if(img.length>0){img.attr('src',img.data('src'));img.removeAttr('data-src');}});var lis=$('.extensions-list').find('li[data-page="'+page+'"]');lis.addClass('shown');if(typeof($('.gallery-search').val())!='undefined'&&$('.gallery-search').val()){$('.gallery-search').keyup();}else{lis.removeClass('dn');}}});if($('.gallery-search').val())$('.gallery-search').keyup()}});}}