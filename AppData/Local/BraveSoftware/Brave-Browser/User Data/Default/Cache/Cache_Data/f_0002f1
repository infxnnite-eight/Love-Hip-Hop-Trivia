import{e as k,H as q,q as H}from"./utils.e0eabc77.js";const B=""+new URL("../assets/skus_sdk_bg.f5a4add5.wasm",import.meta.url).href;let i;const y=new Array(32).fill(void 0);y.push(void 0,null,!0,!1);function c(a){return y[a]}let j=y.length;function J(a){a<36||(y[a]=j,j=a)}function v(a){const r=c(a);return J(a),r}let F=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});F.decode();let I=null;function O(){return(I===null||I.buffer!==i.memory.buffer)&&(I=new Uint8Array(i.memory.buffer)),I}function f(a,r){return F.decode(O().subarray(a,a+r))}function u(a){j===y.length&&y.push(y.length+1);const r=j;return j=y[r],y[r]=a,r}let d=0,W=new TextEncoder("utf-8");const V=typeof W.encodeInto=="function"?function(a,r){return W.encodeInto(a,r)}:function(a,r){const o=W.encode(a);return r.set(o),{read:a.length,written:o.length}};function l(a,r,o){if(o===void 0){const _=W.encode(a),b=r(_.length);return O().subarray(b,b+_.length).set(_),d=_.length,b}let s=a.length,e=r(s);const n=O();let t=0;for(;t<s;t++){const _=a.charCodeAt(t);if(_>127)break;n[e+t]=_}if(t!==s){t!==0&&(a=a.slice(t)),e=o(e,s,s=t+a.length*3);const _=O().subarray(e+t,e+s),b=V(a,_);t+=b.written}return d=t,e}let T=null;function p(){return(T===null||T.buffer!==i.memory.buffer)&&(T=new Int32Array(i.memory.buffer)),T}function g(a){return a==null}function C(a){const r=typeof a;if(r=="number"||r=="boolean"||a==null)return`${a}`;if(r=="string")return`"${a}"`;if(r=="symbol"){const e=a.description;return e==null?"Symbol":`Symbol(${e})`}if(r=="function"){const e=a.name;return typeof e=="string"&&e.length>0?`Function(${e})`:"Function"}if(Array.isArray(a)){const e=a.length;let n="[";e>0&&(n+=C(a[0]));for(let t=1;t<e;t++)n+=", "+C(a[t]);return n+="]",n}const o=/\[object ([^\]]+)\]/.exec(toString.call(a));let s;if(o.length>1)s=o[1];else return toString.call(a);if(s=="Object")try{return"Object("+JSON.stringify(a)+")"}catch{return"Object"}return a instanceof Error?`${a.name}: ${a.message}
${a.stack}`:s}function D(a,r,o,s){const e={a,b:r,cnt:1,dtor:o},n=(...t)=>{e.cnt++;const _=e.a;e.a=0;try{return s(_,e.b,...t)}finally{--e.cnt===0?i.__wbindgen_export_2.get(e.dtor)(_,e.b):e.a=_}};return n.original=e,n}function z(a,r){i._dyn_core__ops__function__FnMut_____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__ha84eca60a4210e45(a,r)}function G(a,r,o){i._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__h021c693a7473cfc9(a,r,u(o))}function K(a,r,o,s,e){var n=l(a,i.__wbindgen_malloc,i.__wbindgen_realloc),t=d,_=g(o)?0:l(o,i.__wbindgen_malloc,i.__wbindgen_realloc),b=d,m=g(s)?0:l(s,i.__wbindgen_malloc,i.__wbindgen_realloc),h=d,S=g(e)?0:l(e,i.__wbindgen_malloc,i.__wbindgen_realloc),N=d,P=i.initialize(n,t,g(r)?16777215:r?1:0,_,b,m,h,S,N);return v(P)}function w(a,r){try{return a.apply(this,r)}catch(o){i.__wbindgen_exn_store(u(o))}}function Q(a,r){return O().subarray(a/1,a/1+r)}function X(a,r,o,s){i.wasm_bindgen__convert__closures__invoke2_mut__h181fb4bbc4d6427e(a,r,u(o),u(s))}class U{static __wrap(r){const o=Object.create(U.prototype);return o.ptr=r,o}__destroy_into_raw(){const r=this.ptr;return this.ptr=0,r}free(){const r=this.__destroy_into_raw();i.__wbg_jssdk_free(r)}refresh_order(r){var o=l(r,i.__wbindgen_malloc,i.__wbindgen_realloc),s=d,e=i.jssdk_refresh_order(this.ptr,o,s);return v(e)}submit_order_credentials_to_sign(r){var o=l(r,i.__wbindgen_malloc,i.__wbindgen_realloc),s=d,e=i.jssdk_submit_order_credentials_to_sign(this.ptr,o,s);return v(e)}fetch_order_credentials(r){var o=l(r,i.__wbindgen_malloc,i.__wbindgen_realloc),s=d,e=i.jssdk_fetch_order_credentials(this.ptr,o,s);return v(e)}delete_order_credentials(r){var o=l(r,i.__wbindgen_malloc,i.__wbindgen_realloc),s=d,e=i.jssdk_delete_order_credentials(this.ptr,o,s);return v(e)}credential_summary(r){var o=g(r)?0:l(r,i.__wbindgen_malloc,i.__wbindgen_realloc),s=d,e=i.jssdk_credential_summary(this.ptr,o,s);return v(e)}order_credential_summary(r,o){var s=l(r,i.__wbindgen_malloc,i.__wbindgen_realloc),e=d,n=g(o)?0:l(o,i.__wbindgen_malloc,i.__wbindgen_realloc),t=d,_=i.jssdk_order_credential_summary(this.ptr,s,e,n,t);return v(_)}prepare_credentials_presentation(r,o){var s=l(r,i.__wbindgen_malloc,i.__wbindgen_realloc),e=d,n=g(o)?0:l(o,i.__wbindgen_malloc,i.__wbindgen_realloc),t=d,_=i.jssdk_prepare_credentials_presentation(this.ptr,s,e,n,t);return v(_)}present_order_credentials(r,o,s){var e=l(r,i.__wbindgen_malloc,i.__wbindgen_realloc),n=d,t=g(o)?0:l(o,i.__wbindgen_malloc,i.__wbindgen_realloc),_=d,b=g(s)?0:l(s,i.__wbindgen_malloc,i.__wbindgen_realloc),m=d,h=i.jssdk_present_order_credentials(this.ptr,e,n,t,_,b,m);return v(h)}present_credentials(r,o){var s=g(r)?0:l(r,i.__wbindgen_malloc,i.__wbindgen_realloc),e=d,n=g(o)?0:l(o,i.__wbindgen_malloc,i.__wbindgen_realloc),t=d,_=i.jssdk_present_credentials(this.ptr,s,e,n,t);return v(_)}}async function Y(a,r){if(typeof Response=="function"&&a instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(a,r)}catch(s){if(a.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const o=await a.arrayBuffer();return await WebAssembly.instantiate(o,r)}else{const o=await WebAssembly.instantiate(a,r);return o instanceof WebAssembly.Instance?{instance:o,module:a}:o}}async function x(a){typeof a>"u"&&(a=new URL(""+new URL("../assets/skus_sdk_bg.f5a4add5.wasm",import.meta.url).href,self.location));const r={};r.wbg={},r.wbg.__wbindgen_cb_drop=function(e){const n=v(e).original;if(n.cnt--==1)return n.a=0,!0;var t=!1;return t},r.wbg.__wbindgen_object_drop_ref=function(e){v(e)},r.wbg.__wbg_instanceof_ChromeWindow_ce18e04a71cbd26e=function(e){var n=c(e)instanceof Window;return n},r.wbg.__wbg_chrome_e1f7320a34333c8b=function(e){var n=c(e).chrome;return g(n)?0:u(n)},r.wbg.__wbg_braveSkus_4a02779cb3b7b396=function(e){var n=c(e).braveSkus;return g(n)?0:u(n)},r.wbg.__wbg_fetchordercredentials_d3be0b035454fb58=function(e,n,t){var _=c(e).fetch_order_credentials(f(n,t));return u(_)},r.wbg.__wbindgen_json_parse=function(e,n){var t=JSON.parse(f(e,n));return u(t)},r.wbg.__wbindgen_string_new=function(e,n){var t=f(e,n);return u(t)},r.wbg.__wbg_refreshorder_a76456898d7cf3a2=function(e,n,t){var _=c(e).refresh_order(f(n,t));return u(_)},r.wbg.__wbg_instanceof_Headers_c88961910a11293e=function(e){var n=c(e)instanceof Headers;return n},r.wbg.__wbg_entries_cb88440eb4b5b4d8=function(e){var n=c(e).entries();return u(n)},r.wbg.__wbindgen_json_serialize=function(e,n){const t=c(n);var _=JSON.stringify(t===void 0?null:t),b=l(_,i.__wbindgen_malloc,i.__wbindgen_realloc),m=d;p()[e/4+1]=m,p()[e/4+0]=b},r.wbg.__wbg_credentialsummary_8a92319a8f2b2622=function(e,n,t){var _=c(e).credential_summary(n===0?void 0:f(n,t));return u(_)},r.wbg.__wbg_jssdk_new=function(e){var n=U.__wrap(e);return u(n)},r.wbg.__wbindgen_string_get=function(e,n){const t=c(n);var _=typeof t=="string"?t:void 0,b=g(_)?0:l(_,i.__wbindgen_malloc,i.__wbindgen_realloc),m=d;p()[e/4+1]=m,p()[e/4+0]=b},r.wbg.__wbg_new_693216e109162396=function(){var e=new Error;return u(e)},r.wbg.__wbg_stack_0ddaca5d1abfb52f=function(e,n){var t=c(n).stack,_=l(t,i.__wbindgen_malloc,i.__wbindgen_realloc),b=d;p()[e/4+1]=b,p()[e/4+0]=_},r.wbg.__wbg_error_09919627ac0992f5=function(e,n){try{console.error(f(e,n))}finally{i.__wbindgen_free(e,n)}},r.wbg.__wbg_self_86b4b13392c7af56=function(){return w(function(){var e=self.self;return u(e)},arguments)},r.wbg.__wbg_crypto_b8c92eaac23d0d80=function(e){var n=c(e).crypto;return u(n)},r.wbg.__wbg_msCrypto_9ad6677321a08dd8=function(e){var n=c(e).msCrypto;return u(n)},r.wbg.__wbindgen_is_undefined=function(e){var n=c(e)===void 0;return n},r.wbg.__wbg_static_accessor_MODULE_452b4680e8614c81=function(){var e=s;return u(e)},r.wbg.__wbg_require_f5521a5b85ad2542=function(e,n,t){var _=c(e).require(f(n,t));return u(_)},r.wbg.__wbg_getRandomValues_dd27e6b0652b3236=function(e){var n=c(e).getRandomValues;return u(n)},r.wbg.__wbg_getRandomValues_e57c9b75ddead065=function(e,n){c(e).getRandomValues(c(n))},r.wbg.__wbg_randomFillSync_d2ba53160aec6aba=function(e,n,t){c(e).randomFillSync(Q(n,t))},r.wbg.__wbg_Window_f826a1dec163bacb=function(e){var n=c(e).Window;return u(n)},r.wbg.__wbg_WorkerGlobalScope_967d186155183d38=function(e){var n=c(e).WorkerGlobalScope;return u(n)},r.wbg.__wbg_log_75fc43480a5907a7=function(e,n){console.log(f(e,n))},r.wbg.__wbg_log_a73f6bdd88fae982=function(e,n,t,_,b,m,h,S){console.log(f(e,n),f(t,_),f(b,m),f(h,S))},r.wbg.__wbg_mark_e32edf3b52687c6a=function(e,n){performance.mark(f(e,n))},r.wbg.__wbg_measure_0c2a5c5e55e16643=function(e,n,t,_){performance.measure(f(e,n),f(t,_))},r.wbg.__wbg_instanceof_Window_c4b70662a0d2c5ec=function(e){var n=c(e)instanceof Window;return n},r.wbg.__wbg_document_1c64944725c0d81d=function(e){var n=c(e).document;return g(n)?0:u(n)},r.wbg.__wbg_location_f98ad02632f88c43=function(e){var n=c(e).location;return u(n)},r.wbg.__wbg_localStorage_6775414303ab5085=function(){return w(function(e){var n=c(e).localStorage;return g(n)?0:u(n)},arguments)},r.wbg.__wbg_clearTimeout_2c1ba0016d8bca41=function(e,n){c(e).clearTimeout(n)},r.wbg.__wbg_fetch_cfe0d1dd786e9cd4=function(e,n){var t=c(e).fetch(c(n));return u(t)},r.wbg.__wbg_setTimeout_df66d951b1726b78=function(){return w(function(e,n,t){var _=c(e).setTimeout(c(n),t);return _},arguments)},r.wbg.__wbindgen_object_clone_ref=function(e){var n=c(e);return u(n)},r.wbg.__wbg_hostname_bf5c2bd40fa4f47a=function(){return w(function(e,n){var t=c(n).hostname,_=l(t,i.__wbindgen_malloc,i.__wbindgen_realloc),b=d;p()[e/4+1]=b,p()[e/4+0]=_},arguments)},r.wbg.__wbg_clear_3b79b768abdfeed8=function(){return w(function(e){c(e).clear()},arguments)},r.wbg.__wbg_get_f0092ad67dc97639=function(){return w(function(e,n,t,_){var b=c(n)[f(t,_)],m=g(b)?0:l(b,i.__wbindgen_malloc,i.__wbindgen_realloc),h=d;p()[e/4+1]=h,p()[e/4+0]=m},arguments)},r.wbg.__wbg_set_3a236a97145dc780=function(){return w(function(e,n,t,_,b){c(e)[f(n,t)]=f(_,b)},arguments)},r.wbg.__wbg_set_5357fedb30848723=function(){return w(function(e,n,t,_,b){c(e).set(f(n,t),f(_,b))},arguments)},r.wbg.__wbg_clearTimeout_c1f246d6874c0679=function(e,n){c(e).clearTimeout(n)},r.wbg.__wbg_setTimeout_5314850184d61a44=function(){return w(function(e,n,t){var _=c(e).setTimeout(c(n),t);return _},arguments)},r.wbg.__wbg_instanceof_HtmlDocument_1faa18f5a2da6fb3=function(e){var n=c(e)instanceof HTMLDocument;return n},r.wbg.__wbg_setcookie_c635212ca1f741c4=function(){return w(function(e,n,t){c(e).cookie=f(n,t)},arguments)},r.wbg.__wbg_instanceof_Response_e1b11afbefa5b563=function(e){var n=c(e)instanceof Response;return n},r.wbg.__wbg_status_6d8bb444ddc5a7b2=function(e){var n=c(e).status;return n},r.wbg.__wbg_headers_5ffa990806e04cfc=function(e){var n=c(e).headers;return u(n)},r.wbg.__wbg_arrayBuffer_b8937ed04beb0d36=function(){return w(function(e){var n=c(e).arrayBuffer();return u(n)},arguments)},r.wbg.__wbg_headers_4764f5445b6a6c89=function(e){var n=c(e).headers;return u(n)},r.wbg.__wbg_newwithstrandinit_9b0fa00478c37287=function(){return w(function(e,n,t){var _=new Request(f(e,n),c(t));return u(_)},arguments)},r.wbg.__wbg_newnoargs_be86524d73f67598=function(e,n){var t=new Function(f(e,n));return u(t)},r.wbg.__wbg_next_7720502039b96d00=function(){return w(function(e){var n=c(e).next();return u(n)},arguments)},r.wbg.__wbg_done_b06cf0578e89ff68=function(e){var n=c(e).done;return n},r.wbg.__wbg_value_e74a542443d92451=function(e){var n=c(e).value;return u(n)},r.wbg.__wbg_call_888d259a5fefc347=function(){return w(function(e,n){var t=c(e).call(c(n));return u(t)},arguments)},r.wbg.__wbg_new_0b83d3df67ecb33e=function(){var e=new Object;return u(e)},r.wbg.__wbg_call_346669c262382ad7=function(){return w(function(e,n,t){var _=c(e).call(c(n),c(t));return u(_)},arguments)},r.wbg.__wbg_getTime_10d33f4f2959e5dd=function(e){var n=c(e).getTime();return n},r.wbg.__wbg_new0_fd3a3a290b25cdac=function(){var e=new Date;return u(e)},r.wbg.__wbg_new_b1d61b5687f5e73a=function(e,n){try{var t={a:e,b:n},_=(m,h)=>{const S=t.a;t.a=0;try{return X(S,t.b,m,h)}finally{t.a=S}},b=new Promise(_);return u(b)}finally{t.a=t.b=0}},r.wbg.__wbg_resolve_d23068002f584f22=function(e){var n=Promise.resolve(c(e));return u(n)},r.wbg.__wbg_then_2fcac196782070cc=function(e,n){var t=c(e).then(c(n));return u(t)},r.wbg.__wbg_then_8c2d62e8ae5978f7=function(e,n,t){var _=c(e).then(c(n),c(t));return u(_)},r.wbg.__wbg_self_c6fbdfc2918d5e58=function(){return w(function(){var e=self.self;return u(e)},arguments)},r.wbg.__wbg_window_baec038b5ab35c54=function(){return w(function(){var e=window.window;return u(e)},arguments)},r.wbg.__wbg_globalThis_3f735a5746d41fbd=function(){return w(function(){var e=globalThis.globalThis;return u(e)},arguments)},r.wbg.__wbg_global_1bc0b39582740e95=function(){return w(function(){var e=global.global;return u(e)},arguments)},r.wbg.__wbg_buffer_397eaa4d72ee94dd=function(e){var n=c(e).buffer;return u(n)},r.wbg.__wbg_newwithbyteoffsetandlength_4b9b8c4e3f5adbff=function(e,n,t){var _=new Uint8Array(c(e),n>>>0,t>>>0);return u(_)},r.wbg.__wbg_new_a7ce447f15ff496f=function(e){var n=new Uint8Array(c(e));return u(n)},r.wbg.__wbg_set_969ad0a60e51d320=function(e,n,t){c(e).set(c(n),t>>>0)},r.wbg.__wbg_length_1eb8fc608a0d4cdb=function(e){var n=c(e).length;return n},r.wbg.__wbg_newwithlength_929232475839a482=function(e){var n=new Uint8Array(e>>>0);return u(n)},r.wbg.__wbg_subarray_8b658422a224f479=function(e,n,t){var _=c(e).subarray(n>>>0,t>>>0);return u(_)},r.wbg.__wbg_set_82a4e8a85e31ac42=function(){return w(function(e,n,t){var _=Reflect.set(c(e),c(n),c(t));return _},arguments)},r.wbg.__wbindgen_debug_string=function(e,n){var t=C(c(n)),_=l(t,i.__wbindgen_malloc,i.__wbindgen_realloc),b=d;p()[e/4+1]=b,p()[e/4+0]=_},r.wbg.__wbindgen_throw=function(e,n){throw new Error(f(e,n))},r.wbg.__wbindgen_memory=function(){var e=i.memory;return u(e)},r.wbg.__wbindgen_closure_wrapper1201=function(e,n,t){var _=D(e,n,386,z);return u(_)},r.wbg.__wbindgen_closure_wrapper2124=function(e,n,t){var _=D(e,n,616,G);return u(_)},(typeof a=="string"||typeof Request=="function"&&a instanceof Request||typeof URL=="function"&&a instanceof URL)&&(a=fetch(a));const{instance:o,module:s}=await Y(await a,r);return i=o.exports,x.__wbindgen_wasm_module=s,i}let M;const Z=async function(){return await x(M),await K.apply(this,arguments)},ee=function(a){M=a};let R;function ne(){const{host:a}=window.location;if(a==="search-dev-local.brave.com")return"testing";switch(a.split(".").slice(-2).join(".")){case"brave.com":return"production";case"bravesoftware.com":return"staging";case"brave.software":return"development";default:return"testing"}}function te(a){localStorage.setItem("app.paid.lastOrderId",a)}function E(){return localStorage.getItem("app.paid.lastOrderId")}function ae(a){localStorage.setItem("app.captcha.lastOrderId",a)}function L(){return localStorage.getItem("app.captcha.lastOrderId")}async function $(){if(R)return R;const a=ne();let r;const o=window.location.hostname;return o.endsWith(".onion")&&o.startsWith("search.")&&(r=`https://payment.rewards.${o.slice(7)}`),ee(B),R=await Z(a,!1,a==="production"?"error":"debug",r),R}async function _e(a){let r,o,s;try{const e=await $();s="refresh_order",r=Date.now();const n=await e.refresh_order(a);o=Date.now(),k("sdk.refresh_order",o-r),s="credential_summary",r=Date.now();const t=await e.order_credential_summary(n.id,n.location);if(o=Date.now(),k("sdk.credential_summary",o-r),["paid","canceled"].includes(n.status))(!t||!t.active)&&(s="fetch_order_credentials",r=Date.now(),await e.fetch_order_credentials(a),o=Date.now(),k("sdk.fetch_order_credentials",o-r));else throw new Error("Order not paid.")}catch(e){throw new Error(e.message)}}async function A(a){if(!a)return!1;try{const r=await $();k("calling present_order_credentials...");const o=Date.now();await r.present_order_credentials(a);for(const[e,n]of Object.entries(q()))e.includes("sku#")&&H(e,n,void 0,!1,1e3);const s=Date.now();return k("sdk.present_order_credentials",s-o),k("present_order_credentials returned"),!0}catch{return!1}}function oe(){const a=new URLSearchParams(window.location.search),r=a.get("intent"),o=a.get("order");let s;if(o)try{const e=JSON.parse(atob(o));e.recovery_expiration>Date.now()&&(s=e.order_id),k("[paid] order details",e)}catch{}return{intent:r,orderId:s}}async function ce(a){var s;if(a)return!0;if(!((s=document.cookie)!=null&&s.includes("sku#brave-search-premium")))return!1;const r=await fetch("/api/paid",{method:"GET",credentials:"same-origin"}),{paying:o}=await r.json();return await A(E()),o}function ie(){var r,o,s,e;const a=L();if(!a)return!1;for(let n=0;n<window.localStorage.length;n+=1){const t=window.localStorage.key(n);if(t&&t.startsWith("skus:")){const _=JSON.parse(window.localStorage.getItem(t)??"{}"),b=(o=(r=_==null?void 0:_.orders[a])==null?void 0:r.items[0])==null?void 0:o.id;if(b)return(((e=(s=_==null?void 0:_.credentials)==null?void 0:s.items[b])==null?void 0:e.unblinded_creds)??[]).some(({spent:m})=>m===!1)===!0}}return!1}async function se(){try{const a=Date.now(),r=await A(E()),o=await A(L()),s=Date.now();return k("[paid] setTemporaryCredentialCookie",s-a),{populatedPremium:r,populatedCaptcha:o}}catch(a){console.error(a)}return{populatedPremium:!1,populatedCaptcha:!1}}export{oe as a,te as b,ie as c,ae as d,L as e,E as g,ce as i,se as p,_e as r,A as s};
